<template name="editSampleGroup">
  <div class="ui top attached menu">
    {{#if length addableStudies}}
      {{> addStudyMenu addableStudies=addableStudies
          sampleGroup=sampleGroup}}
    {{else}}
      <div class="ui item">
        No more studies
      </div>
    {{/if}}

    <div class="right menu">
      <div class="item">
        <div class="ui transparent icon input">
          <input class="sample-group-name" type="text"
              placeholder="Name of sample group...">
          <!-- <i class="idea icon"></i> -->
          <div class="ui basic label sample-group-version"
              data-content="Sample group version">
            v{{getSampleGroup.version}}
          </div>
        </div>
      </div>
    </div>
  </div>

  {{#if Template.subscriptionsReady}}
    <div class="ui bottom attached segment">
      {{#with getSampleGroup}}
        <div class="ui list">
          {{#if length studies}}
            {{! show all of the studies}}
            {{#each studies}}
              <div class="item">
                <!-- <i class="icon"></i> {{! blank icons create indentation}} -->
                <div class="content">
                  <div class="header">
                    {{getStudyName study_label}}

                    <div class="ui mini buttons">
                      {{> addFilterButton study=this sampleGroup=sampleGroup
                          studyIndex=@index}}
                      <button class="ui icon button remove-study">
                        <i class="minus icon"></i> Remove
                      </button>
                    </div>
                  </div>
                  <div class="description"></div>
                  <div class="list" style="padding-top: 0px;">
                    {{#let studyIndex=@index}}
                      {{#each filters}}
                        {{> showFilter studyIndex=studyIndex filterIndex=@index
                            sampleGroup=sampleGroup}}
                      {{/each}}
                    {{/let}}
                  </div>
                </div>
              </div>
            {{/each}}
          {{else}}
            No studies
          {{/if}}
        </div>
      {{/with}}
    </div>
  {{else}}
    {{> dataLoading}}
  {{/if}}
</template>

<template name="addStudyMenu">
  <div class="ui item dropdown"> {{! "dropdown" for hand as mouse}}
    Add a study <i class="dropdown icon"></i>
  </div>
  <div class="ui flowing popup">
    <div class="ui list">
      {{#each addableStudies}}
        <a class="item add-study-to-sample-group">
          {{name}}
        </a>
      {{/each}}
    </div>
  </div>
</template>

<template name="addFilterButton">
  <div class="ui icon item dropdown button"> {{! "dropdown" for hand as mouse}}
    <i class="filter icon"></i> Add filter
  </div>
  <div class="ui flowing popup">
    <div class="ui list" style="padding: 0px;">
      <a class="item add-sample-label-list-filter">
        Include Specific samples
      </a>
    </div>
    <div class="ui list" style="padding: 0px;">
      <a class="item add-exclude-sample-label-list-filter">
        Exclude Specific samples
      </a>
    </div>
    <div class="ui list" style="padding: 0px;">
      <a class="item add-data-loaded-filter">
        Require data loaded
      </a>
    </div>
  </div>
</template>

<template name="showFilter">
  <div class="item">
    <i class="filter icon"></i>
    <div class="content" style="width: 100%;">
      {{#with getFilter}}
        {{#if compare type "sample_label_list"}}
          {{> sampleLabelListFilter options=getFilter.options
              setOptions=setOptions study_label=study_label
              title="Include specific samples"}}
        {{/if}}

        {{#if compare type "exclude_sample_label_list"}}
          {{> sampleLabelListFilter options=getFilter.options
              setOptions=setOptions study_label=study_label
              title="Exclude specific samples"}}
        {{/if}}

        {{#if compare type "data_loaded"}}
          {{> dataLoadedFilter study_label=study_label
              options=getFilter.options setOptions=setOptions}}
        {{/if}}
      {{/with}}
    </div>
  </div>
</template>

<template name="sampleLabelListFilter">
  {{title}}:
  {{#if getEditing}}
    <div class="ui form">
      <div class="field">
        <textarea value={{sampleLabelsToText}}
            placeholder="Enter sample names seperated by newlines, commas, or semicolons."></textarea>
      </div>
    </div>

    {{#if length getInvalidSampleLabels}}
      <div class="ui error message">
        <i class="close icon close-sample-error-message"></i>
        <div class="header">
          The following sample names are invalid
        </div>
        <ul class="list">
          {{#each getInvalidSampleLabels}}
            <li>{{this}}</li>
          {{/each}}
        </ul>
      </div>
    {{/if}}

    <button class="ui icon primary mini button done-editing">
      <i class="check icon"></i> Done
    </button>
  {{else}}
    {{#if length options.sample_labels}}
      {{#each options.sample_labels}}
        <div class="ui label">
          {{this}}
        </div>
      {{/each}}
    {{else}}
      None
    {{/if}}

    <div class="ui mini buttons">
      <button class="ui icon mini button edit-filter">
        <i class="edit icon"></i> Edit filter
      </button>

      <button class="ui icon button remove-filter">
        <i class="minus icon"></i> Remove filter
      </button>
    </div>
  {{/if}}
</template>

<template name="dataLoadedFilter">
  Require the following data:
  <div class="ui grid" style="margin-left: 0px; margin-top: -4px;">
    <div class="row">
      <div class="ui checkbox gene-expression">
        <input type="checkbox" name="example">
        <label>Gene expression</label>
      </div>
    </div>
  </div>
</template>
