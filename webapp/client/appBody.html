<head>
  <script src="https://docs.handsontable.com/pro/1.3.4/bower_components/handsontable-pro/dist/handsontable.full.min.js"></script>
  <link rel="stylesheet" href="https://docs.handsontable.com/pro/1.3.4/bower_components/handsontable-pro/dist/handsontable.full.min.css">
</head>

<template name="appBody">
  {{! shared modals that are used on multiple pages}}
  {{> editCollaborationsModal}}

  <div class="ui container">
    <div style="margin-bottom: 15px;">
      <div class="ui breadcrumb large">
        {{#breadcrumbItem isActive=(isActiveRoute "home")
            href=(pathFor 'home')}}
          MedBook Patient Care
        {{/breadcrumbItem}}

        {{#if or (isActiveRoute "listPatients") (isActiveRoute "patient")}}
          {{#breadcrumbItem isActive=(isActiveRoute "listPatients")
              href=(pathFor "listPatients")}}
            Patients
          {{/breadcrumbItem}}

          {{#if isActiveRoute "patient"}}
            {{#breadcrumbItem isActive=true
                href=(pathFor "patient" patient_id=params.patient_id)}}
              {{getPatientLabel}}
            {{/breadcrumbItem}}
          {{/if}}
        {{/if}}

        {{#if activeRouteIsInTools}}
          {{#breadcrumbItem isActive=(isActiveRoute "listTools")
              href=(pathFor "listTools")}}
            Tools
          {{/breadcrumbItem}}

          {{#if isActiveRoute "listLimmaGSEA"}}
            {{#breadcrumbItem isActive=true}}
              Limma <i class="right arrow icon"></i> GSEA
            {{/breadcrumbItem}}
          {{/if}}

          {{#if isActiveRoute "listTumorMap"}}
            {{#breadcrumbItem isActive=true}}
              Tumor Map
            {{/breadcrumbItem}}
          {{/if}}

          {{#if or (isActiveRoute "listUpDownGenes")
              (isActiveRoute "upDownGenesJob")}}
            {{#breadcrumbItem isActive=(isActiveRoute "listUpDownGenes")
                href=(pathFor "listUpDownGenes")}}
              Outlier Analysis
            {{/breadcrumbItem}}
          {{/if}}

          {{#if isActiveRoute "upDownGenesJob"}}
            {{#breadcrumbItem isActive=true}}
              Result
            {{/breadcrumbItem}}
          {{/if}}
        {{/if}}

        {{#if threeOr (isActiveRoute "manageCollaborations")
            (isActiveRoute "createCollaboration")
            (isActiveRoute "browseCollaborations")}}
          {{#breadcrumbItem isActive=true}}
            Collaborations
          {{/breadcrumbItem}}
        {{/if}}

        {{#if or (isActiveRoute "manageDataSets")
            (isActiveRoute "createDataSet")}}
          {{#breadcrumbItem isActive=true}}
            Data sets
          {{/breadcrumbItem}}
        {{/if}}

        {{! Experimental}}

        {{#if isActiveRoute "createRecord"}}
          {{#breadcrumbItem isActive=true}}Create record{{/breadcrumbItem}}
        {{/if}}

        {{#if isActiveRoute "createForm"}}
          {{#breadcrumbItem isActive=true}}Create form{{/breadcrumbItem}}
        {{/if}}

        {{#if isActiveRoute "editRecords"}}
          {{#breadcrumbItem isActive=true}}Edit records{{/breadcrumbItem}}
        {{/if}}

        {{! Utility}}

        {{#if invalidUrl}}
          {{#breadcrumbItem isActive=true}}Invalid URL{{/breadcrumbItem}}
        {{/if}}
      </div>

      <div style="float: right;">
        {{> loginButtons}}
      </div>
    </div>

    {{#if loggingIn}}
      {{> loggingInMessage}}
    {{else}}
      {{#if currentUser}}
        {{#if currentMedBookUser}}
          {{>Template.dynamic template=content data=params}}
        {{else}}
          {{> loggingInMessage}}
        {{/if}}
      {{else}}
        <div class="ui massive icon message">
          <i class="warning sign icon"></i>
          <div class="content">
            <div class="header">
              Not logged in!
            </div>
            <p>
              Please log in to continue
            </p>
          </div>
        </div>
      {{/if}}
    {{/if}}
  </div>
</template>

<template name="breadcrumbItem">
  {{#if isActive}}
    <div class="section active">
      {{> UI.contentBlock}}
    </div>
  {{else}}
    <a href={{href}}>
      {{> UI.contentBlock}}
    </a>
    <span class="divider">/</span>
  {{/if}}
</template>

<template name="loggingInMessage">
  <div class="ui massive icon message">
    <i class="notched circle loading icon"></i>
    <div class="content">
      <div class="header">
        Logging in...
      </div>
      <p>
        You'll be on your way in just a moment!
      </p>
    </div>
  </div>
</template>

<template name="dataLoading">
  <div class="ui icon message">
    <i class="notched circle loading icon"></i>
    <div class="content">
      <div class="header">
        One moment please...
      </div>
      <p>We're fetching that data for you.</p>
    </div>
  </div>
</template>

<template name="routeNotFound">
  <div class="ui message massive">
    <div class="header">Invalid URL</div>
    <p>
      To be completely honest, we don't quite know how you found your way here...
    </p>
    <p>
      Click here to return to the home page:
      <a href={{pathFor "home"}} class="ui primary button">
        <i class="home icon"></i>
        Go home!
      </a>
    </p>
    <p>
      If you think you are seeing this message in error, please {{> contactTeoButton}}
    </p>
  </div>
</template>

<template name="contactTeoButton">
  <a href="mailto:dtflemin@ucsc.com?subject=MedBook%20Patient%20Care"
      class="ui button teal">
    <i class="bug icon"></i>
    Contact Teo
  </a>
</template>
